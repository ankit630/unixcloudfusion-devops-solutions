secret_detection:
  stage: pre-build
  image: docker:stable
  services:
    - docker:dind
  script:
    - apk add --no-cache git
    - git clone https://github.com/zricethezav/gitleaks.git
    - cd gitleaks
    - docker build -t gitleaks .
    - cd ..
    - docker run --rm -v ${PWD}:/path gitleaks --path=/path -v
  artifacts:
    paths:
      - gitleaks_report.json
